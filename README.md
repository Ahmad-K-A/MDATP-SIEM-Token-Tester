# MDATP SIEM Token Tester
The purpose of this project is to allow testing a SIEM's flow when fetching MDATP alerts through its respective REST API. The project provides the possibility to test using the two supported OAuth2.0 flows for the MDATP REST API: Authorization Code and Client Credentials. The MSAL library is used to facilitate both token flows and the REST API is called through basic HTTP Client calls.

### To build MDATP SIEM Checker

I generally suggest downloading the code and building it accordingly for debugging purposes. If you need to test this tool out directly, you may go to the relseases:

    https://github.com/Ahmad-K-A/MDATP-SIEM-Token-Tester/releases

When building, add the following NuGet packages:

    Microsoft.Identity.Client

    System.Web.Http.Common

### To use the tool

Make sure to fill in the:

  * Client ID 
  
  * Client Secret   
 
  * Tenant Domain (or Tenant ID; whichever is available to you)
  
  * The Redirect URL (You can get this by going to AAD portal -> App Registrations -> Your respective SIEM MDATP registration -> Authentication -> Redirect URI with localhost)

You may now choose to test with either the Authorization Code Flow or the Client Credentials Flow by choosing the respective tab and generating the tokens accordinlgy. Auth Code will take you through an interactive AAD password prompt (which is similar to way that most SIEMs operate with this API) and the Client Creds flow with fetch a token as a daemon application. After fetching the respective tokens, you may now test the API by running "Fetch Alerts" having made sure that you have a correct MDATP API URL filled in. I recommend testing with the following URL while making sure you are including a respective date:
    
    https://wdatp-alertexporter-eu.windows.com/api/alerts?limit=20&sinceTimeUtc=YYYY-MM-DDT00:00:00.000
    
Finally, you can check the logs generated by this tool through pressing on "Open Log File". This should show you the output of the alerts in raw format as well as any possible errors during your run. The overall purpose here is to allow you to troubleshoot possible SIEM issues through a logging and a debug-able tool as most SIEMs seem (pardon the pun) to have minimal logging.

### Useful articles

Documentation surrounding the API and how to manually use it:

    https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/pull-alerts-using-rest-api

Documentation on troubleshooting SIEM tool integration issues:

    https://docs.microsoft.com/en-us/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-siem

A blog that I have written on using the MSAL library:

    https://developermessaging.azurewebsites.net/2019/10/07/msal-basics-a-guide-to-azure-ads-authentication-library/
